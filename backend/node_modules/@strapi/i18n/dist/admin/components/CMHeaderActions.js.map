{"version":3,"file":"CMHeaderActions.js","sources":["../../../admin/src/components/CMHeaderActions.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { skipToken } from '@reduxjs/toolkit/query';\nimport {\n  useNotification,\n  useQueryParams,\n  Table,\n  useAPIErrorHandler,\n  FormErrors,\n  useForm,\n} from '@strapi/admin/strapi-admin';\nimport { useAIAvailability } from '@strapi/admin/strapi-admin/ee';\nimport {\n  type DocumentActionComponent,\n  type DocumentActionProps,\n  unstable_useDocument as useDocument,\n  unstable_useDocumentActions as useDocumentActions,\n  buildValidParams,\n  HeaderActionProps,\n} from '@strapi/content-manager/strapi-admin';\nimport {\n  Flex,\n  Status,\n  Typography,\n  Button,\n  Modal,\n  Field,\n  SingleSelect,\n  SingleSelectOption,\n  Dialog,\n  type StatusVariant,\n  Box,\n  Link,\n} from '@strapi/design-system';\nimport { WarningCircle, ListPlus, Trash, Earth, Cross, Plus, Sparkle } from '@strapi/icons';\nimport { useIntl } from 'react-intl';\nimport { NavLink, useNavigate } from 'react-router-dom';\nimport { styled } from 'styled-components';\n\nimport { useAILocalizationJobsPolling } from '../hooks/useAILocalizationJobsPolling';\nimport { useI18n } from '../hooks/useI18n';\nimport { useGetAILocalizationJobsByDocumentQuery } from '../services/aiLocalizationJobs';\nimport { useGetLocalesQuery } from '../services/locales';\nimport { useGetManyDraftRelationCountQuery } from '../services/relations';\nimport { useGetSettingsQuery } from '../services/settings';\nimport { cleanData } from '../utils/clean';\nimport { getTranslation } from '../utils/getTranslation';\nimport { capitalize } from '../utils/strings';\n\nimport { BulkLocaleActionModal } from './BulkLocaleActionModal';\n\nimport type { Locale } from '../../../shared/contracts/locales';\nimport type { I18nBaseQuery } from '../types';\nimport type { Modules } from '@strapi/types';\n\n/* -------------------------------------------------------------------------------------------------\n * LocalePickerAction\n * -----------------------------------------------------------------------------------------------*/\n\ninterface LocaleOptionProps {\n  isDraftAndPublishEnabled: boolean;\n  locale: Locale;\n  status: 'draft' | 'published' | 'modified';\n  entryExists: boolean;\n  translationStatus?: 'processing' | 'failed' | 'completed' | undefined;\n}\n\nconst statusVariants: Record<LocaleOptionProps['status'], StatusVariant> = {\n  draft: 'secondary',\n  published: 'success',\n  modified: 'alternative',\n};\n\nconst LocaleOption = ({\n  isDraftAndPublishEnabled,\n  locale,\n  status,\n  entryExists,\n}: LocaleOptionProps) => {\n  const { formatMessage } = useIntl();\n\n  if (!entryExists) {\n    return formatMessage(\n      {\n        id: getTranslation('CMEditViewLocalePicker.locale.create'),\n        defaultMessage: 'Create <bold>{locale}</bold> locale',\n      },\n      {\n        bold: (locale: React.ReactNode) => <b>{locale}</b>,\n        locale: locale.name,\n      }\n    );\n  }\n\n  return (\n    <Flex width=\"100%\" gap={1} justifyContent=\"space-between\">\n      <Typography>{locale.name}</Typography>\n      {isDraftAndPublishEnabled ? (\n        <Status\n          display=\"flex\"\n          paddingLeft=\"6px\"\n          paddingRight=\"6px\"\n          paddingTop=\"2px\"\n          paddingBottom=\"2px\"\n          size=\"S\"\n          variant={statusVariants[status]}\n        >\n          <Typography tag=\"span\" variant=\"pi\" fontWeight=\"bold\">\n            {capitalize(status)}\n          </Typography>\n        </Status>\n      ) : null}\n    </Flex>\n  );\n};\n\nconst LocaleOptionStartIcon = ({\n  entryWithLocaleExists,\n  translationStatus,\n  index,\n}: {\n  entryWithLocaleExists: boolean;\n  translationStatus?: 'processing' | 'failed' | 'completed' | undefined;\n  index?: number;\n}) => {\n  const isAiAvailable = useAIAvailability();\n\n  if (!entryWithLocaleExists) {\n    return <Plus />;\n  }\n\n  if (isAiAvailable && index !== 0 && translationStatus === 'failed') {\n    return <WarningCircle fill=\"warning600\" />;\n  }\n\n  return null;\n};\n\nconst LocalePickerAction = ({\n  document,\n  meta,\n  model,\n  collectionType,\n  documentId,\n}: HeaderActionProps) => {\n  const { formatMessage } = useIntl();\n  const [{ query }, setQuery] = useQueryParams<I18nBaseQuery>();\n  const { hasI18n, canCreate, canRead } = useI18n();\n  const { data: locales = [] } = useGetLocalesQuery();\n  const currentDesiredLocale = query.plugins?.i18n?.locale;\n  const { schema } = useDocument({\n    model,\n    collectionType,\n    documentId,\n    params: { locale: currentDesiredLocale },\n  });\n  const { data: jobData } = useGetAILocalizationJobsByDocumentQuery({\n    documentId: documentId!,\n    model: model!,\n    collectionType: collectionType!,\n  });\n  const { data: settings } = useGetSettingsQuery();\n  const isAiAvailable = useAIAvailability();\n\n  const handleSelect = React.useCallback(\n    (value: string) => {\n      setQuery({\n        plugins: {\n          ...query.plugins,\n          i18n: {\n            locale: value,\n          },\n        },\n      });\n    },\n    [query.plugins, setQuery]\n  );\n\n  React.useEffect(() => {\n    if (!Array.isArray(locales) || !hasI18n) {\n      return;\n    }\n    /**\n     * Handle the case where the current locale query param doesn't exist\n     * in the list of available locales, so we redirect to the default locale.\n     */\n    const doesLocaleExist = locales.find((loc) => loc.code === currentDesiredLocale);\n    const defaultLocale = locales.find((locale) => locale.isDefault);\n    if (!doesLocaleExist && defaultLocale?.code) {\n      handleSelect(defaultLocale.code);\n    }\n  }, [handleSelect, hasI18n, locales, currentDesiredLocale]);\n\n  const currentLocale = Array.isArray(locales)\n    ? locales.find((locale) => locale.code === currentDesiredLocale)\n    : undefined;\n\n  // Use meta.availableLocales instead of document.localizations\n  // meta.availableLocales contains all locales for the document, even when creating new locales\n  const availableLocales = meta?.availableLocales ?? [];\n  const documentLocalizations = document?.localizations ?? [];\n\n  // Prefer meta.availableLocales as it's more reliable, fallback to document.localizations\n  const allLocalizations = availableLocales.length > 0 ? availableLocales : documentLocalizations;\n\n  const allCurrentLocales = [\n    { status: getDocumentStatus(document, meta), locale: currentLocale?.code },\n    ...allLocalizations,\n  ];\n\n  if (!hasI18n || !Array.isArray(locales) || locales.length === 0) {\n    return null;\n  }\n\n  const displayedLocales = locales.filter((locale) => {\n    /**\n     * If you can read we allow you to see the locale exists\n     * otherwise the locale is hidden.\n     */\n    return canRead.includes(locale.code);\n  });\n\n  const localesSortingDefaultFirst = displayedLocales.sort((a, b) =>\n    a.isDefault ? -1 : b.isDefault ? 1 : 0\n  );\n\n  return {\n    label: formatMessage({\n      id: getTranslation('Settings.locales.modal.locales.label'),\n      defaultMessage: 'Locales',\n    }),\n    options: localesSortingDefaultFirst.map((locale, index) => {\n      const entryWithLocaleExists = allCurrentLocales.some((doc) => doc.locale === locale.code);\n\n      const currentLocaleDoc = allCurrentLocales.find((doc) =>\n        'locale' in doc ? doc.locale === locale.code : false\n      );\n\n      const permissionsToCheck = currentLocaleDoc ? canRead : canCreate;\n\n      if (isAiAvailable && settings?.data?.aiLocalizations) {\n        return {\n          _render: () => (\n            <React.Fragment key={index}>\n              <SingleSelectOption\n                disabled={!permissionsToCheck.includes(locale.code)}\n                key={locale.code}\n                startIcon={\n                  <LocaleOptionStartIcon\n                    entryWithLocaleExists={entryWithLocaleExists}\n                    translationStatus={jobData?.data?.status}\n                    index={index}\n                  />\n                }\n                value={locale.code}\n              >\n                <LocaleOption\n                  isDraftAndPublishEnabled={!!schema?.options?.draftAndPublish}\n                  locale={locale}\n                  status={currentLocaleDoc?.status}\n                  entryExists={entryWithLocaleExists}\n                />\n              </SingleSelectOption>\n              {localesSortingDefaultFirst.length > 1 && index === 0 && (\n                <Box paddingRight={4} paddingLeft={4} paddingTop={2} paddingBottom={2}>\n                  <Typography variant=\"sigma\">\n                    {formatMessage({\n                      id: getTranslation('CMEditViewLocalePicker.locale.ai-translations'),\n                      defaultMessage: 'AI Translations',\n                    })}\n                  </Typography>\n                </Box>\n              )}\n            </React.Fragment>\n          ),\n        };\n      }\n\n      return {\n        disabled: !permissionsToCheck.includes(locale.code),\n        value: locale.code,\n        label: (\n          <LocaleOption\n            isDraftAndPublishEnabled={!!schema?.options?.draftAndPublish}\n            locale={locale}\n            status={currentLocaleDoc?.status}\n            entryExists={entryWithLocaleExists}\n            translationStatus={jobData?.data?.status}\n          />\n        ),\n        startIcon: <LocaleOptionStartIcon entryWithLocaleExists={entryWithLocaleExists} />,\n      };\n    }),\n    customizeContent: () => currentLocale?.name,\n    onSelect: handleSelect,\n    value: currentLocale,\n  };\n};\n\ntype UseDocument = typeof useDocument;\n\nconst getDocumentStatus = (\n  document: ReturnType<UseDocument>['document'],\n  meta: ReturnType<UseDocument>['meta']\n): 'draft' | 'published' | 'modified' => {\n  const docStatus = document?.status;\n  const statuses = meta?.availableStatus ?? [];\n\n  /**\n   * Creating an entry\n   */\n  if (!docStatus) {\n    return 'draft';\n  }\n\n  /**\n   * We're viewing a draft, but the document could have a published version\n   */\n  if (docStatus === 'draft' && statuses.find((doc) => doc.publishedAt !== null)) {\n    return 'published';\n  }\n\n  return docStatus;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * AISettingsStatusAction\n * -----------------------------------------------------------------------------------------------*/\n\nconst AITranslationStatusIcon = styled(Status)<{ $isAISettingEnabled: boolean }>`\n  display: flex;\n  gap: ${({ theme }) => theme.spaces[1]};\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n\n  // Disabled state\n  ${({ $isAISettingEnabled, theme }) =>\n    !$isAISettingEnabled &&\n    `\n    background-color: ${theme.colors.neutral150};\n  `}\n\n  svg {\n    ${({ $isAISettingEnabled, theme }) =>\n      !$isAISettingEnabled &&\n      `\n        fill: ${theme.colors.neutral300};\n      `}\n  }\n`;\n\nconst AITranslationStatusAction = ({ documentId, model, collectionType }: HeaderActionProps) => {\n  const { formatMessage } = useIntl();\n  const isAIAvailable = useAIAvailability();\n  const { data: settings } = useGetSettingsQuery();\n  const isAISettingEnabled = settings?.data?.aiLocalizations;\n  const { hasI18n } = useI18n();\n\n  // Poll for AI localizations jobs when AI is enabled and we have a documentId\n  const { status } = useAILocalizationJobsPolling({\n    documentId,\n    model,\n    collectionType,\n  });\n  const statusVariant = (() => {\n    if (status === 'failed') {\n      return 'warning';\n    }\n\n    if (isAISettingEnabled) {\n      return 'alternative';\n    }\n\n    return 'neutral';\n  })();\n\n  // Do not display this action when i18n is not available\n  if (!hasI18n) {\n    return null;\n  }\n\n  // Do not display this action when AI is not available\n  if (!isAIAvailable) {\n    return null;\n  }\n\n  return {\n    _status: {\n      message: (\n        <Box\n          height=\"100%\"\n          aria-label={formatMessage({\n            id: getTranslation('CMEditViewAITranslation.status-aria-label'),\n            defaultMessage: 'AI Translation Status',\n          })}\n        >\n          <AITranslationStatusIcon\n            $isAISettingEnabled={Boolean(isAISettingEnabled)}\n            variant={statusVariant}\n            size=\"S\"\n          >\n            <Sparkle />\n          </AITranslationStatusIcon>\n        </Box>\n      ),\n      tooltip: (\n        <Flex direction=\"column\" padding={4} alignItems=\"flex-start\" width=\"25rem\">\n          <Typography variant=\"pi\" fontWeight=\"600\">\n            {formatMessage(\n              {\n                id: getTranslation('CMEditViewAITranslation.status-title'),\n                defaultMessage:\n                  '{enabled, select, true {AI translation enabled} false {AI translation disabled} other {AI translation disabled}}',\n              },\n              { enabled: isAISettingEnabled }\n            )}\n          </Typography>\n          <Typography variant=\"pi\" paddingTop={1} paddingBottom={3}>\n            {formatMessage({\n              id: getTranslation('CMEditViewAITranslation.status-description'),\n              defaultMessage:\n                'Our AI translates content in all locales each time you save a modification in the default locale.',\n            })}\n          </Typography>\n          <Link\n            fontSize=\"inherit\"\n            tag={NavLink}\n            to=\"/settings/internationalization\"\n            style={{ alignSelf: 'flex-end' }}\n          >\n            <Typography variant=\"pi\" textAlign=\"right\">\n              {formatMessage(\n                {\n                  id: getTranslation('CMEditViewAITranslation.settings-link'),\n                  defaultMessage:\n                    '{enabled, select, true {Disable it in settings} false {Enable it in settings} other {Enable it in settings}}',\n                },\n                { enabled: isAISettingEnabled }\n              )}\n            </Typography>\n          </Link>\n        </Flex>\n      ),\n    },\n  };\n};\n\n/* -------------------------------------------------------------------------------------------------\n * FillFromAnotherLocaleAction\n * -----------------------------------------------------------------------------------------------*/\n\nconst FillFromAnotherLocaleAction = ({\n  documentId,\n  meta,\n  model,\n  collectionType,\n}: HeaderActionProps) => {\n  const { formatMessage } = useIntl();\n  const [{ query }] = useQueryParams<I18nBaseQuery>();\n  const { hasI18n } = useI18n();\n  const currentDesiredLocale = query.plugins?.i18n?.locale;\n  const [localeSelected, setLocaleSelected] = React.useState<string | null>(null);\n  const setValues = useForm('FillFromAnotherLocale', (state) => state.setValues);\n\n  const { getDocument } = useDocumentActions();\n  const { schema, components } = useDocument({\n    model,\n    documentId,\n    collectionType,\n    params: { locale: currentDesiredLocale },\n  });\n  const { data: locales = [] } = useGetLocalesQuery();\n\n  const isAIAvailable = useAIAvailability();\n  const { data: settings } = useGetSettingsQuery();\n  const isAISettingEnabled = settings?.data?.aiLocalizations;\n\n  const availableLocales = Array.isArray(locales)\n    ? locales.filter((locale) => meta?.availableLocales.some((l) => l.locale === locale.code))\n    : [];\n\n  const fillFromLocale = (onClose: () => void) => async () => {\n    const response = await getDocument({\n      collectionType,\n      model,\n      documentId,\n      params: { locale: localeSelected },\n    });\n    if (!response || !schema) {\n      return;\n    }\n\n    const { data } = response;\n\n    const cleanedData = cleanData(data, schema, components);\n\n    setValues(cleanedData);\n\n    onClose();\n  };\n\n  if (!hasI18n) {\n    return null;\n  }\n\n  // Do not display this action when AI is available and AI translations are enabled\n  if (isAIAvailable && isAISettingEnabled) {\n    return null;\n  }\n\n  return {\n    type: 'icon',\n    icon: <Earth />,\n    disabled: availableLocales.length === 0,\n    label: formatMessage({\n      id: getTranslation('CMEditViewCopyLocale.copy-text'),\n      defaultMessage: 'Fill in from another locale',\n    }),\n    dialog: {\n      type: 'dialog',\n      title: formatMessage({\n        id: getTranslation('CMEditViewCopyLocale.dialog.title'),\n        defaultMessage: 'Confirmation',\n      }),\n      content: ({ onClose }: { onClose: () => void }) => (\n        <>\n          <Dialog.Body>\n            <Flex direction=\"column\" gap={3}>\n              <WarningCircle width=\"24px\" height=\"24px\" fill=\"danger600\" />\n              <Typography textAlign=\"center\">\n                {formatMessage({\n                  id: getTranslation('CMEditViewCopyLocale.dialog.body'),\n                  defaultMessage:\n                    'Your current content will be erased and filled by the content of the selected locale:',\n                })}\n              </Typography>\n              <Field.Root width=\"100%\">\n                <Field.Label>\n                  {formatMessage({\n                    id: getTranslation('CMEditViewCopyLocale.dialog.field.label'),\n                    defaultMessage: 'Locale',\n                  })}\n                </Field.Label>\n                <SingleSelect\n                  value={localeSelected}\n                  placeholder={formatMessage({\n                    id: getTranslation('CMEditViewCopyLocale.dialog.field.placeholder'),\n                    defaultMessage: 'Select one locale...',\n                  })}\n                  // @ts-expect-error â€“ the DS will handle numbers, but we're not allowing the API.\n                  onChange={(value) => setLocaleSelected(value)}\n                >\n                  {availableLocales.map((locale) => (\n                    <SingleSelectOption key={locale.code} value={locale.code}>\n                      {locale.name}\n                    </SingleSelectOption>\n                  ))}\n                </SingleSelect>\n              </Field.Root>\n            </Flex>\n          </Dialog.Body>\n          <Dialog.Footer>\n            <Flex gap={2} width=\"100%\">\n              <Button flex=\"auto\" variant=\"tertiary\" onClick={onClose}>\n                {formatMessage({\n                  id: getTranslation('CMEditViewCopyLocale.cancel-text'),\n                  defaultMessage: 'No, cancel',\n                })}\n              </Button>\n              <Button flex=\"auto\" variant=\"success\" onClick={fillFromLocale(onClose)}>\n                {formatMessage({\n                  id: getTranslation('CMEditViewCopyLocale.submit-text'),\n                  defaultMessage: 'Yes, fill in',\n                })}\n              </Button>\n            </Flex>\n          </Dialog.Footer>\n        </>\n      ),\n    },\n  };\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DeleteLocaleAction\n * -----------------------------------------------------------------------------------------------*/\n\nconst DeleteLocaleAction: DocumentActionComponent = ({\n  document,\n  documentId,\n  model,\n  collectionType,\n}) => {\n  const { formatMessage } = useIntl();\n  const navigate = useNavigate();\n  const { toggleNotification } = useNotification();\n  const { delete: deleteAction, isLoading } = useDocumentActions();\n  const { hasI18n, canDelete } = useI18n();\n\n  // Get the current locale object, using the URL instead of document so it works while creating\n  const [{ query }] = useQueryParams<I18nBaseQuery>();\n  const { data: locales = [] } = useGetLocalesQuery();\n  const currentDesiredLocale = query.plugins?.i18n?.locale;\n  const locale = !('error' in locales) && locales.find((loc) => loc.code === currentDesiredLocale);\n\n  if (!hasI18n) {\n    return null;\n  }\n\n  return {\n    disabled:\n      (document?.locale && !canDelete.includes(document.locale)) || !document || !document.id,\n    position: ['header', 'table-row'],\n    label: formatMessage(\n      {\n        id: getTranslation('actions.delete.label'),\n        defaultMessage: 'Delete entry ({locale})',\n      },\n      { locale: locale && locale.name }\n    ),\n    icon: <StyledTrash />,\n    variant: 'danger',\n    dialog: {\n      type: 'dialog',\n      title: formatMessage({\n        id: getTranslation('actions.delete.dialog.title'),\n        defaultMessage: 'Confirmation',\n      }),\n      content: (\n        <Flex direction=\"column\" gap={2}>\n          <WarningCircle width=\"24px\" height=\"24px\" fill=\"danger600\" />\n          <Typography tag=\"p\" variant=\"omega\" textAlign=\"center\">\n            {formatMessage({\n              id: getTranslation('actions.delete.dialog.body'),\n              defaultMessage: 'Are you sure?',\n            })}\n          </Typography>\n        </Flex>\n      ),\n      loading: isLoading,\n      onConfirm: async () => {\n        const unableToDelete =\n          // We are unable to delete a collection type without a document ID\n          // & unable to delete generally if there is no document locale\n          (collectionType !== 'single-types' && !documentId) || !document?.locale;\n\n        if (unableToDelete) {\n          console.error(\n            \"You're trying to delete a document without an id or locale, this is likely a bug with Strapi. Please open an issue.\"\n          );\n\n          toggleNotification({\n            message: formatMessage({\n              id: getTranslation('actions.delete.error'),\n              defaultMessage: 'An error occurred while trying to delete the document locale.',\n            }),\n            type: 'danger',\n          });\n\n          return;\n        }\n\n        const res = await deleteAction({\n          documentId,\n          model,\n          collectionType,\n          params: { locale: document.locale },\n        });\n\n        if (!('error' in res)) {\n          navigate({ pathname: `../${collectionType}/${model}` }, { replace: true });\n        }\n      },\n    },\n  };\n};\n\nexport type LocaleStatus = {\n  locale: string;\n  status: Modules.Documents.Params.PublicationStatus.Kind | 'modified';\n};\n\ninterface ExtendedDocumentActionProps extends DocumentActionProps {\n  action?: 'bulk-publish' | 'bulk-unpublish';\n}\n\n/* -------------------------------------------------------------------------------------------------\n * BulkLocaleAction\n *\n * This component is used to handle bulk publish and unpublish actions on locales.\n * -----------------------------------------------------------------------------------------------*/\n\nconst BulkLocaleAction: DocumentActionComponent = ({\n  document,\n  documentId,\n  model,\n  collectionType,\n  action,\n}: ExtendedDocumentActionProps) => {\n  const locale = document?.locale ?? null;\n  const [{ query }] = useQueryParams<{ status: 'draft' | 'published' }>();\n\n  const params = React.useMemo(() => buildValidParams(query), [query]);\n  const isOnPublishedTab = query.status === 'published';\n\n  const { formatMessage } = useIntl();\n  const { hasI18n, canPublish } = useI18n();\n  const { toggleNotification } = useNotification();\n  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();\n\n  const [selectedRows, setSelectedRows] = React.useState<any[]>([]);\n  const [isDraftRelationConfirmationOpen, setIsDraftRelationConfirmationOpen] =\n    React.useState<boolean>(false);\n\n  const { publishMany: publishManyAction, unpublishMany: unpublishManyAction } =\n    useDocumentActions();\n\n  const { schema, validate } = useDocument(\n    {\n      model,\n      collectionType,\n      documentId,\n      params: {\n        locale,\n      },\n    },\n    {\n      // No need to fetch the document, the data is already available in the `document` prop\n      skip: true,\n    }\n  );\n\n  const { data: localesMetadata = [] } = useGetLocalesQuery(hasI18n ? undefined : skipToken);\n\n  const headers = [\n    {\n      label: formatMessage({\n        id: 'global.name',\n        defaultMessage: 'Name',\n      }),\n      name: 'name',\n    },\n    {\n      label: formatMessage({\n        id: getTranslation('CMEditViewBulkLocale.status'),\n        defaultMessage: 'Status',\n      }),\n      name: 'status',\n    },\n    {\n      label: formatMessage({\n        id: getTranslation('CMEditViewBulkLocale.publication-status'),\n        defaultMessage: 'Publication Status',\n      }),\n      name: 'publication-status',\n    },\n  ];\n\n  // Extract the rows for the bulk locale publish modal and any validation\n  // errors per locale\n  const [rows, validationErrors] = React.useMemo(() => {\n    if (!document) {\n      return [[], {}];\n    }\n\n    const localizations = document.localizations ?? [];\n\n    // Build the rows for the bulk locale publish modal by combining the current\n    // document with all the available locales from the document meta\n    const locales: LocaleStatus[] = localizations.map((doc: any) => {\n      const { locale, status } = doc;\n      return { locale, status };\n    });\n\n    // Add the current document locale\n    locales.unshift({\n      locale: document.locale,\n      status: document.status,\n    });\n\n    // Build the validation errors for each locale.\n    const allDocuments = [document, ...localizations];\n    const errors = allDocuments.reduce<FormErrors>((errs, document) => {\n      if (!document) {\n        return errs;\n      }\n\n      // Validate each locale entry via the useDocument validate function and store any errors in a dictionary\n      const validation = validate(document as Modules.Documents.AnyDocument);\n      if (validation !== null) {\n        errs[document.locale] = validation;\n      }\n      return errs;\n    }, {});\n\n    return [locales, errors];\n  }, [document, validate]);\n\n  const isBulkPublish = action === 'bulk-publish';\n  const localesForAction = selectedRows.reduce((acc: string[], selectedRow: LocaleStatus) => {\n    const isValidLocale =\n      // Validation errors are irrelevant if we are trying to unpublish\n      !isBulkPublish || !Object.keys(validationErrors).includes(selectedRow.locale);\n\n    const shouldAddLocale = isBulkPublish\n      ? selectedRow.status !== 'published' && isValidLocale\n      : selectedRow.status !== 'draft' && isValidLocale;\n\n    if (shouldAddLocale) {\n      acc.push(selectedRow.locale);\n    }\n\n    return acc;\n  }, []);\n\n  // TODO skipping this for now as there is a bug with the draft relation count that will be worked on separately\n  // see https://www.notion.so/strapi/Count-draft-relations-56901b492efb45ab90d42fe975b32bd8?pvs=4\n  const enableDraftRelationsCount = false;\n  const {\n    data: draftRelationsCount = 0,\n    isLoading: isDraftRelationsLoading,\n    error: isDraftRelationsError,\n  } = useGetManyDraftRelationCountQuery(\n    {\n      model,\n      documentIds: [documentId!],\n      locale: localesForAction,\n    },\n    {\n      skip: !enableDraftRelationsCount || !documentId || localesForAction.length === 0,\n    }\n  );\n\n  React.useEffect(() => {\n    if (isDraftRelationsError) {\n      toggleNotification({\n        type: 'danger',\n        message: formatAPIError(isDraftRelationsError),\n      });\n    }\n  }, [isDraftRelationsError, toggleNotification, formatAPIError]);\n\n  if (!schema?.options?.draftAndPublish) {\n    return null;\n  }\n\n  if (!hasI18n) {\n    return null;\n  }\n\n  if (!documentId) {\n    return null;\n  }\n\n  // This document action can be enabled given that draft and publish and i18n are\n  // enabled and we can publish the current locale.\n\n  const publish = async () => {\n    await publishManyAction({\n      model,\n      documentIds: [documentId],\n      params: {\n        ...params,\n        locale: localesForAction,\n      },\n    });\n\n    setSelectedRows([]);\n  };\n\n  const unpublish = async () => {\n    await unpublishManyAction({\n      model,\n      documentIds: [documentId],\n      params: {\n        ...params,\n        locale: localesForAction,\n      },\n    });\n\n    setSelectedRows([]);\n  };\n\n  const handleAction = async () => {\n    if (draftRelationsCount > 0) {\n      setIsDraftRelationConfirmationOpen(true);\n    } else if (isBulkPublish) {\n      await publish();\n    } else {\n      await unpublish();\n    }\n  };\n\n  if (isDraftRelationConfirmationOpen) {\n    return {\n      label: formatMessage({\n        id: 'app.components.ConfirmDialog.title',\n        defaultMessage: 'Confirmation',\n      }),\n      variant: 'danger',\n      dialog: {\n        onCancel: () => {\n          setIsDraftRelationConfirmationOpen(false);\n        },\n        onConfirm: async () => {\n          await publish();\n\n          setIsDraftRelationConfirmationOpen(false);\n        },\n        type: 'dialog',\n        title: formatMessage({\n          id: getTranslation('actions.publish.dialog.title'),\n          defaultMessage: 'Confirmation',\n        }),\n        content: (\n          <Flex direction=\"column\" alignItems=\"center\" gap={2}>\n            <WarningCircle width=\"2.4rem\" height=\"2.4rem\" fill=\"danger600\" />\n            <Typography textAlign=\"center\">\n              {formatMessage({\n                id: getTranslation('CMEditViewBulkLocale.draft-relation-warning'),\n                defaultMessage:\n                  'Some locales are related to draft entries. Publishing them could leave broken links in your app.',\n              })}\n            </Typography>\n            <Typography textAlign=\"center\">\n              {formatMessage({\n                id: getTranslation('CMEditViewBulkLocale.continue-confirmation'),\n                defaultMessage: 'Are you sure you want to continue?',\n              })}\n            </Typography>\n          </Flex>\n        ),\n      },\n    };\n  }\n\n  const hasPermission = selectedRows\n    .map(({ locale }) => locale)\n    .every((locale) => canPublish.includes(locale));\n\n  return {\n    label: formatMessage({\n      id: getTranslation(`CMEditViewBulkLocale.${isBulkPublish ? 'publish' : 'unpublish'}-title`),\n      defaultMessage: `${isBulkPublish ? 'Publish' : 'Unpublish'} Multiple Locales`,\n    }),\n    variant: isBulkPublish ? 'secondary' : 'danger',\n    icon: isBulkPublish ? <ListPlus /> : <Cross />,\n    disabled: isOnPublishedTab || canPublish.length === 0,\n    position: ['panel'],\n    dialog: {\n      type: 'modal',\n      title: formatMessage({\n        id: getTranslation(`CMEditViewBulkLocale.${isBulkPublish ? 'publish' : 'unpublish'}-title`),\n        defaultMessage: `${isBulkPublish ? 'Publish' : 'Unpublish'} Multiple Locales`,\n      }),\n      content: () => {\n        return (\n          <Table.Root\n            headers={headers}\n            rows={rows.map((row) => ({\n              ...row,\n              id: row.locale,\n            }))}\n            selectedRows={selectedRows}\n            onSelectedRowsChange={(tableSelectedRows) => setSelectedRows(tableSelectedRows)}\n          >\n            <BulkLocaleActionModal\n              validationErrors={validationErrors}\n              headers={headers}\n              rows={rows}\n              localesMetadata={localesMetadata as Locale[]}\n              action={action ?? 'bulk-publish'}\n            />\n          </Table.Root>\n        );\n      },\n      footer: () => (\n        <Modal.Footer justifyContent=\"flex-end\">\n          <Button\n            loading={isDraftRelationsLoading}\n            disabled={!hasPermission || localesForAction.length === 0}\n            variant=\"default\"\n            onClick={handleAction}\n          >\n            {formatMessage({\n              id: isBulkPublish ? 'app.utils.publish' : 'app.utils.unpublish',\n              defaultMessage: isBulkPublish ? 'Publish' : 'Unpublish',\n            })}\n          </Button>\n        </Modal.Footer>\n      ),\n    },\n  };\n};\n\n/* -------------------------------------------------------------------------------------------------\n * BulkLocalePublishAction\n * -----------------------------------------------------------------------------------------------*/\nconst BulkLocalePublishAction: DocumentActionComponent = (props: ExtendedDocumentActionProps) => {\n  return BulkLocaleAction({ action: 'bulk-publish', ...props });\n};\n\n/* -------------------------------------------------------------------------------------------------\n * BulkLocaleUnpublishAction\n * -----------------------------------------------------------------------------------------------*/\nconst BulkLocaleUnpublishAction: DocumentActionComponent = (props: ExtendedDocumentActionProps) => {\n  return BulkLocaleAction({ action: 'bulk-unpublish', ...props });\n};\n\n/**\n * Because the icon system is completely broken, we have to do\n * this to remove the fill from the cog.\n */\nconst StyledTrash = styled(Trash)`\n  path {\n    fill: currentColor;\n  }\n`;\n\nexport {\n  BulkLocalePublishAction,\n  BulkLocaleUnpublishAction,\n  DeleteLocaleAction,\n  LocalePickerAction,\n  FillFromAnotherLocaleAction,\n  AITranslationStatusAction,\n};\n"],"names":["statusVariants","draft","published","modified","LocaleOption","isDraftAndPublishEnabled","locale","status","entryExists","formatMessage","useIntl","id","getTranslation","defaultMessage","bold","_jsx","b","name","_jsxs","Flex","width","gap","justifyContent","Typography","Status","display","paddingLeft","paddingRight","paddingTop","paddingBottom","size","variant","tag","fontWeight","capitalize","LocaleOptionStartIcon","entryWithLocaleExists","translationStatus","index","isAiAvailable","useAIAvailability","Plus","WarningCircle","fill","LocalePickerAction","document","meta","model","collectionType","documentId","query","setQuery","useQueryParams","hasI18n","canCreate","canRead","useI18n","data","locales","useGetLocalesQuery","currentDesiredLocale","plugins","i18n","schema","useDocument","params","jobData","useGetAILocalizationJobsByDocumentQuery","settings","useGetSettingsQuery","handleSelect","React","useCallback","value","useEffect","Array","isArray","doesLocaleExist","find","loc","code","defaultLocale","isDefault","currentLocale","undefined","availableLocales","documentLocalizations","localizations","allLocalizations","length","allCurrentLocales","getDocumentStatus","displayedLocales","filter","includes","localesSortingDefaultFirst","sort","a","label","options","map","some","doc","currentLocaleDoc","permissionsToCheck","aiLocalizations","_render","Fragment","SingleSelectOption","disabled","startIcon","draftAndPublish","Box","customizeContent","onSelect","docStatus","statuses","availableStatus","publishedAt","AITranslationStatusIcon","styled","theme","spaces","$isAISettingEnabled","colors","neutral150","neutral300","AITranslationStatusAction","isAIAvailable","isAISettingEnabled","useAILocalizationJobsPolling","statusVariant","_status","message","height","aria-label","Boolean","Sparkle","tooltip","direction","padding","alignItems","enabled","Link","fontSize","NavLink","to","style","alignSelf","textAlign","FillFromAnotherLocaleAction","localeSelected","setLocaleSelected","useState","setValues","useForm","state","getDocument","useDocumentActions","components","l","fillFromLocale","onClose","response","cleanedData","cleanData","type","icon","Earth","dialog","title","content","_Fragment","Dialog","Body","Field","Root","Label","SingleSelect","placeholder","onChange","Footer","Button","flex","onClick","DeleteLocaleAction","navigate","useNavigate","toggleNotification","useNotification","delete","deleteAction","isLoading","canDelete","position","StyledTrash","loading","onConfirm","unableToDelete","console","error","res","pathname","replace","BulkLocaleAction","action","useMemo","buildValidParams","isOnPublishedTab","canPublish","_unstableFormatAPIError","formatAPIError","useAPIErrorHandler","selectedRows","setSelectedRows","isDraftRelationConfirmationOpen","setIsDraftRelationConfirmationOpen","publishMany","publishManyAction","unpublishMany","unpublishManyAction","validate","skip","localesMetadata","skipToken","headers","rows","validationErrors","unshift","allDocuments","errors","reduce","errs","validation","isBulkPublish","localesForAction","acc","selectedRow","isValidLocale","Object","keys","shouldAddLocale","push","enableDraftRelationsCount","draftRelationsCount","isDraftRelationsLoading","isDraftRelationsError","useGetManyDraftRelationCountQuery","documentIds","publish","unpublish","handleAction","onCancel","hasPermission","every","ListPlus","Cross","Table","row","onSelectedRowsChange","tableSelectedRows","BulkLocaleActionModal","footer","Modal","BulkLocalePublishAction","props","BulkLocaleUnpublishAction","Trash"],"mappings":"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"}